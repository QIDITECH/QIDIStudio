{
    "type": "machine",
    "setting_id": "GM001",
    "name": "X-Max 4 0.4 nozzle",
    "from": "system",
    "instantiation": "true",
    "inherits": "fdm_machine_x_common",
    "printer_model": "X-Max 4",
    "gcode_flavor": "klipper",
    "default_print_profile": "0.20mm Standard @X-Max 4",
    "printer_settings_id": "Qidi",
    "bed_exclude_area": ["0x0,11x0,11x16,0x16"],
    "change_filament_gcode": "G1 Z{max_layer_z + 3.0} F1200\nTOOL_CHANGE_START F=[current_extruder] T=[next_extruder]\nDISABLE_ALL_SENSOR\nM104 S{(nozzle_temperature_range_high[current_extruder])-40}\nM106 S255\n{if long_retractions_when_cut[previous_extruder]}\nG1 E-{retraction_distances_when_cut[previous_extruder]} F{old_filament_e_feedrate}\n{else}\nG1 E-5 F{old_filament_e_feedrate}\n{endif}\nM400\nCUT_FILAMENT T=[current_extruder]\nMOVE_TO_TRASH\nG1 X135 F15000\nM106 S255\nM106 P2 S0\nM400\nUNLOAD_T[current_extruder]\nG1 X135 F14999\nT[next_extruder]\nM106 S0\nM400\n{if nozzle_temperature_range_high[current_extruder] >= nozzle_temperature_range_high[next_extruder]}\nM104 S{nozzle_temperature_range_high[current_extruder]}\nTEMPERATURE_WAIT SENSOR=extruder MINIMUM={(nozzle_temperature_range_high[current_extruder])-25}\n{else}\nM104 S{nozzle_temperature_range_high[next_extruder]}\nTEMPERATURE_WAIT SENSOR=extruder MINIMUM={(nozzle_temperature_range_high[next_extruder])-25}\n{endif}\nM400\n; FLUSH_START\nG1 E60 F{old_filament_e_feedrate}\n; FLUSH_END\n{if long_retractions_when_cut[previous_extruder]}\nG1 E{retraction_distances_when_cut[previous_extruder]} F{old_filament_e_feedrate}\n{endif}\nM400\nM106 S0\n{if flush_length_1 > 1}\n; FLUSH_START\n{if flush_length_1 > 23.7}\nG1 X130 F9000\nG1 E23.7 F{old_filament_e_feedrate}\nG1 E{(flush_length_1 - 23.7) * 1} F{old_filament_e_feedrate}\n{else}\nG1 E{flush_length_1} F{old_filament_e_feedrate}\n{endif}\n; FLUSH_END\n{endif}\n{if flush_length_2 > 1}\n; FLUSH_START\nG1 X135 F9000\nG1 E[old_retract_length_toolchange] F300\nG1 E{flush_length_2 * 1} F{new_filament_e_feedrate}\n; FLUSH_END\n{endif}\n{if flush_length_3 > 1}\n; FLUSH_START\nG1 X130 F9000\nG1 E[new_retract_length_toolchange] F300\nG1 E{flush_length_3 * 1} F{new_filament_e_feedrate}\n; FLUSH_END\n{endif}\n{if flush_length_4 > 1}\n; FLUSH_START\nG1 X135 F9000\nG1 E[new_retract_length_toolchange] F300\nG1 E{flush_length_4 * 1} F{new_filament_e_feedrate}\n; FLUSH_END\n{endif}\nM400\nM106 S180\nM104 S{(new_filament_temp)-12}\nG1 E8 F25\nG1 E-5 F1000\nTEMPERATURE_WAIT SENSOR=extruder MAXIMUM={(new_filament_temp)-11}\nM204 S10000\nG1 X180 F15000\nG1 Y383 F10000\nG1 X116 F10000\nG4 P2000\nG1 Y403 F4000\nG1 X130 F10000\nG1 X162 F10000\nG1 X145 F10000\nG1 X180 F10000\nG1 X162 F10000\nG1 X180 F10000\nG1 X162 F10000\nG1 X180 F10000\nG1 X162 F10000\nG1 X180 F10000\nG1 Y380 F15000\nM104 S[new_filament_temp]\nTOOL_CHANGE_END\nG1 E2 F{new_filament_e_feedrate}\nENABLE_ALL_SENSOR\n",
    "default_filament_profile": ["QIDI PLA Rapido @Qidi X-Max 4 0.4 nozzle"],
    "enable_long_retraction_when_cut": "2",
    "extruder_clearance_height_to_lid": "120",
    "extruder_clearance_height_to_rod": "40",
    "extruder_clearance_max_radius": "70",
    "is_support_3mf" : "1",
    "is_support_timelapse": "1",
    "is_support_multi_box": "1",
    "layer_change_gcode": "{if timelapse_type == 1} ; timelapse with wipe tower\nG92 E0\nG1 E-[retraction_length] F1800\nG2 Z{layer_z + 0.4} I0.86 J0.86 P1 F20000 ; spiral lift a little\nG1 Y380 F20000\nG1 X128 F20000\n{if layer_z <=25}\nG1 Z25\n{endif}\nG1 Y403 F2000\nG92 E0\nM400\nTIMELAPSE_TAKE_FRAME\nG1 E[retraction_length] F300\nG1 X180 F8000\nG1 Y380 F8000\n{if layer_z <=25}\nG1 Z[layer_z]\n{endif}\n{elsif timelapse_type == 0} ; timelapse without wipe tower\nTIMELAPSE_TAKE_FRAME\n{endif}\nG92 E0\nSET_PRINT_STATS_INFO CURRENT_LAYER={layer_num + 1}",
    "machine_end_gcode": "DISABLE_BOX_HEATER\nM141 S0\nM140 S0\nDISABLE_ALL_SENSOR\nG1 E-3 F1800\nG0 Z{max_layer_z + 3} F600\nUNLOAD_FILAMENT T=[current_extruder]\nG0 Y380 F12000\nG0 X128 Y380 F12000\n{if max_layer_z < max_print_height / 2}G1 Z{max_print_height / 2 + 10} F600{else}G1 Z{min(max_print_height, max_layer_z + 3)}{endif}\nM104 S0\nPRINT_END",
    "machine_max_jerk_e": ["4"],
    "machine_max_jerk_x": ["9"],
    "machine_max_jerk_y": ["9"],
    "machine_max_jerk_z": ["4"],
    "machine_max_speed_z": ["20"],
    "machine_pause_gcode": "M0",
    "machine_max_acceleration_x": ["30000"],
    "machine_max_acceleration_y": ["30000"],
    "machine_max_speed_x": ["800"],
    "machine_max_speed_y": ["800"],
    "machine_start_gcode": ";===== print_phase_init_start ===========================\nSET_PRINT_MAIN_STATUS MAIN_STATUS=print_start\nM220 S100 \nM221 S100 \nM1001 \nDISABLE_ALL_SENSOR\nM1002 R1\nM107        \nCLEAR_PAUSE \nM140 S[bed_temperature_initial_layer_single]\nM141 S[chamber_temperatures]\nG29.0\nG28\n;===== print_phase_init_end ===========================\n\n;===== print_start_box_prepar_start ===========================\nBOX_PRINT_START EXTRUDER=[initial_no_support_extruder] HOTENDTEMP=[nozzle_temperature_initial_layer]\nM400\nEXTRUSION_AND_FLUSH HOTEND=[nozzle_temperature_initial_layer]\n;===== print_box_prepar_end ===========================\n\n\n;===== print_start_phase_preheat_start ===========================\n;===== CLEAR_NOZZLE  ===========================\n\nG1 Z20 F480\nMOVE_TO_TRASH\nM400\n    M109 S[nozzle_temperature_initial_layer] \n    G92 E0\n    M83\n    G1 E5 F80\n    G1 E250 F300\n    M400\n    M106 S255\n    G1 E-3 F1000\n    M104 S140\n    M109.1 S{nozzle_temperature_initial_layer[0]-30}\n\n\n    M204 S10000\n    G1 X162 F10000\n    G1 X143 F6000\n    G1 X162 F10000\n    G1 X143 F6000\n\n    G1 X180 F20000\n    G1 Y395 F6000\n    G1 X188 F6000\n    G1 Z-0.2 F480\n\n    M106 S255    \n    M109.1 S150\n\n    G91\n    G1 X15 F200\n    G1 Y2 F200\n    G1 X-15 F200\n    G1 Y-2 F200\n    G1 X15 F200\n    G90\n\n    G2 I0.5 J0.5 F480  \n    G2 I0.5 J0.5 F480\n    G2 I0.5 J0.5 F480\n    G1 Z10\n    G1 Y383 F10000\n\n    G1 Y373 F12000\n    G1 X116 F12000\n    G1 Y383 F12000\n    G1 Y403 F2000\n    G1 X128 F12000\n    M400\n\n    G1 X176 F12000\n    G1 X163 F12000\n    G1 X176 F12000\n    G1 X163 F12000\n    G1 X176 F12000\n    G1 X163 F12000\n    G1 X176 F12000\n    G1 X163 F12000\n    G1 X180 F12000\n    G1 X128 F12000\n    M106 S0 \n    M400\n\n    M190 S[bed_temperature_initial_layer_single]\n    M191 S[chamber_temperatures] \n    M204 S10000\n    G1 Y0 F9000\n    G1 X15 F9000\n    G1 X2 F5000\n    M83 \n    G1 E-4 F1000\n    G4 P1000\n    G1 X3 F1000\n    G1 X2 F5000\n    G4 P1000\n    G1 X15 F3000\n    M400\n    G4 P2000\n    Z_TILT_ADJUST\n    G29\n\n    M1002 A1\n\n{if (chamber_temperatures[0] == 0)}\n    M106 P3 S255\n{endif}  \n\nM1004\nM106 S[nozzle_temperature_initial_layer] \nG1 X380 Y5  F30000\nM109 S[nozzle_temperature_initial_layer] \nENABLE_ALL_SENSOR\n;============================PRINT_START==============================\n\nSET_PRINT_MAIN_STATUS MAIN_STATUS=printing\nSET_PRINT_STATS_INFO TOTAL_LAYER=[total_layer_count]\nM83\nT[initial_tool]\nM140 S[bed_temperature_initial_layer_single]\nM104 S[nozzle_temperature_initial_layer]\nM141 S[chamber_temperatures]\nG4 P3000\nG0 X200 Y1 F30000\nG0 Z10 F1200\nG4 P3000\nprobe  samples=1 \nG91\nG0 Z5 F600\nG90\nG1 X173 Y1 F30000\nG91 \nG0 Z{initial_layer_print_height-5} F600\nG90\nG0 X193 E8  F{outer_wall_volumetric_speed/(24/20) * 60}\nG0 X198 E.3742  F{outer_wall_volumetric_speed/(0.3*0.5)/4 * 60}\nG0 X203 E.3742  F{outer_wall_volumetric_speed/(0.3*0.5) * 60}\nG0 X208 E.3742  F{outer_wall_volumetric_speed/(0.3*0.5)/4 * 60}\nG0 X213 E.3742  F{outer_wall_volumetric_speed/(0.3*0.5)     * 60}\nG0 X218 E.3742  F{outer_wall_volumetric_speed/(0.3*0.5)/4 * 60}\nG91\nG1 X1 Z{-initial_layer_print_height-0.1}\nG1 X4\nG1 Z1 F1200\nG90\nM400\nG1 X173 Y2.5 F30000\nG91\nG1 Z-0.7 F1200\nG90\nM83\nG0 X193 E10  F{outer_wall_volumetric_speed/(24/20) * 60}\nG0 X198 E.3742  F{outer_wall_volumetric_speed/(0.3*0.5)/4 * 60}\nG0 X203 E.3742  F{outer_wall_volumetric_speed/(0.3*0.5) * 60}\nG0 X208 E.3742  F{outer_wall_volumetric_speed/(0.3*0.5)/4 * 60}\nG0 X213 E.3742  F{outer_wall_volumetric_speed/(0.3*0.5) * 60}\nG0 X218 E.3742  F{outer_wall_volumetric_speed/(0.3*0.5)/4 * 60}\nG91\nG1 X1 Z{-initial_layer_print_height-0.1}\nG1 X4\nG1 Z1 F1200\nG90\nM400\nG1 Z1 F600",
    "nozzle_diameter": ["0.4"],
    "nozzle_volume": ["150"],
    "printable_area": ["0x0","390x0","390x390","0x390"],
    "printable_height": "340",
    "retract_lift_below": ["339"],
    "support_box_temp_control": "1",
    "thumbnail_size": ["50x50"],
    "fan_direction": "left"
}
